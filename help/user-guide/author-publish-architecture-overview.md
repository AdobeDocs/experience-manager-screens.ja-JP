---
title: オーサーとパブリッシュのアーキテクチャの概要
description: AEM Screensのアーキテクチャは、AEM Sitesの従来のアーキテクチャに似ています。 コンテンツはAEM オーサーインスタンスで作成され、次に複数のパブリッシュインスタンスに転送レプリケートされます。
content-type: reference
topic-tags: administering
products: SG_EXPERIENCEMANAGER/6.5/SCREENS
docset: aem65
feature: Administering Screens
role: Admin, Developer
level: Intermediate
exl-id: ba23eb8e-bbde-4a6e-8cfb-ae98176ed890
source-git-commit: ef74265eadf5972eae7451b7725946d8b014c198
workflow-type: tm+mt
source-wordcount: '986'
ht-degree: 23%

---

# オーサーとパブリッシュのアーキテクチャの概要 {#author-and-publish-architectural-overview}

ここでは、以下のトピックについて重点的に説明します。

* **パブリッシュサーバーについて**
* **アーキテクチャの概要**
* **登録プロセス**

## 前提条件 {#prerequisites}

オーサーサーバーとパブリッシュサーバーについて学ぶ前に、次の知識が必要です。

* **AEM トポロジ**
* **AEM Screens プロジェクトの作成と管理**
* **デバイス登録プロセス**

>[!NOTE]
>
>このAEM Screens機能は、AEM 6.4 Screens 機能パック 2 をインストールしている場合にのみ使用できます。 この機能パックへのアクセス権を取得するには、Adobeサポートに連絡してアクセス権をリクエストします。 権限が付与されたら、Package Share からダウンロードします。

## はじめに {#introduction}

AEM Screensのアーキテクチャは、AEM Sitesの従来のアーキテクチャに似ています。 コンテンツは AEM オーサーインスタンスで作成された後、複数のパブリッシュインスタンスにフォワードレプリケートされます。AEM Screens上のデバイスは、ロードバランサーを介してAEM パブリッシュファームに接続できるようになりました。 複数の AEM パブリッシュンスタンスを追加して、パブリッシュファームの拡大／縮小を続行できます。

*例：* AEM Screens コンテンツ作成者は、特定のデバイスのオーサリングシステムでコマンドを発行します。 このデバイスは、パブリッシュファームとやり取りするように設定されています。 または、パブリッシュファームとやり取りするように設定されているデバイスに関する情報を取得するAEM Screens コンテンツ作成者とやり取りします。

次の図に、オーサー環境と公開環境の両方を示します。

![screen_shot_2019-03-04at30236pm](assets/screen_shot_2019-03-04at30236pm.png)

## アーキテクチャ設計 {#architectural-design}

このソリューションを促進するアーキテクチャコンポーネントが 5 つあります。

* デバイス別にオーサーからパブリッシュにディスプレイの&#x200B;***コンテンツをレプリケート***

* ***リバース*** バイナリコンテンツをパブリッシュ環境（デバイスから受信）からオーサリング環境にレプリケートする。
* ***送信*** 特定の REST API を使用してオーサーからパブリッシュするコマンド。
* ***メッセージング*** パブリッシュインスタンス間でデバイス情報の更新とコマンドを同期する。
* ***ポーリング*** パブリッシュインスタンスの作成者が、特定の REST API を使用してデバイス情報を取得する

### コンテンツと設定のレプリケーション（フォワード） {#replication-forward-of-content-and-configurations}

標準のレプリケーションエージェントを使用して、AEM Screens チャネルのコンテンツ、場所の設定、デバイスの設定をレプリケートします。 この機能を使用すると、作成者はチャネルのコンテンツを更新できます。また、オプションで、チャネルの更新を公開する前に何らかの承認ワークフローを実行することもできます。 レプリケーションエージェントは、パブリッシュファームの各パブリッシュインスタンスに対して作成する必要があります。

レプリケーションプロセスの例を次の図に示します。

![screen_shot_2019-03-04at33935pm](assets/screen_shot_2019-03-04at33935pm.png)

>[!NOTE]
>
>レプリケーションエージェントは、パブリッシュファームの各パブリッシュインスタンスに対して作成する必要があります。

### Screens レプリケーションエージェントとコマンド {#screens-replication-agents-and-commands}

オーサーインスタンスから AEM Screens デバイスにコマンドを送信するには、Screens 固有のカスタムレプリケーションエージェントを作成します。AEM パブリッシュインスタンスは、これらのコマンドをデバイスに転送する仲介役となります。

このワークフローにより、作成者は、デバイスの更新を送信したり、オーサー環境からスクリーンショットを撮ったりするなど、デバイスを引き続き管理できます。 AEM Screens レプリケーションエージェントには、標準レプリケーションエージェントなどのカスタムトランスポート設定があります。

### パブリッシュインスタンス間のメッセージング {#messaging-between-publish-instances}

多くの場合、コマンドは 1 回だけデバイスに送信されます。 ただし、負荷分散パブリッシュアーキテクチャでは、デバイスの接続先のパブリッシュインスタンスが不明です。

したがって、オーサーインスタンスはすべてのパブリッシュインスタンスにメッセージを送信します。ただし、その後は 1 つのメッセージのみがデバイスに中継されます。 正しいメッセージングを行うには、パブリッシュインスタンス間で通信を行う必要があります。 この通信を行うには、次のコマンドを使用します *Apache ActiveMQ Artemis*. 各パブリッシュインスタンスは、Oak ベースの Sling 検出サービスを使用して、疎結合トポロジに配置されます。 ActiveMQ は、各パブリッシュインスタンスが通信し、単一のメッセージキューを作成できるように設定されます。 AEM Screens デバイスは、ロードバランサーを介してAEM パブリッシュファームをポーリングし、キューの先頭からコマンドを取得します。

### リバースレプリケーション {#reverse-replication}

多くの場合、コマンドに従って、Screens デバイスから何らかの応答がオーサーインスタンスに転送されます。 このAEMを実現するには ***リバースレプリケーション*** が使用されます。

* 標準レプリケーションエージェントやAEM Screens レプリケーションエージェントと同様に、リバースレプリケーションエージェントを各パブリッシュインスタンスに作成します。
* ワークフローランチャー設定は、AEM パブリッシュインスタンス上で変更されたノードをリッスンし、次に、デバイスの応答をAEM パブリッシュインスタンスのアウトボックスに配置するワークフローをトリガーします。
* このコンテキストでのリバースレプリケーションは、デバイスから提供されるバイナリデータ（ログファイルやスクリーンショットなど）にのみ使用されます。 非バイナリデータのポーリングを取得する。
* AEM オーサーインスタンスからのリバースレプリケーションポーリングで、応答を取得して、オーサーインスタンスに保存します。

### パブリッシュインスタンスのポーリング {#polling-of-publish-instances}

オーサーインスタンスは、デバイスをポーリングしてハートビートを取得し、接続されたデバイスのヘルスステータスを把握できる必要があります。

デバイスはロードバランサーに ping を送信し、パブリッシュインスタンスにルーティングされます。その後、デバイスのステータスは、提供されたパブリッシュ API を通じてAEM パブリッシュインスタンスによって公開されます@ **api/screens-dcc/devices/static** すべてのアクティブなデバイス用および **api/screens-dcc/devices/&lt;device_id>/status.json** 単一のデバイスの場合。

オーサーインスタンスは、すべてのパブリッシュインスタンスをポーリングし、デバイスのステータス応答を 1 つのステータスに結合します。オーサー上でポーリングするスケジュール済みは `com.adobe.cq.screens.impl.jobs.DistributedDevicesStatiUpdateJob` で、Cron 形式に基づいて設定できます。

## 登録 {#registration}

登録は AEM オーサーインスタンスで継続的に開始されます。AEM Screens デバイスがオーサーインスタンスを指し、登録が完了します。

デバイスがAEM オーサー環境に登録されると、デバイス設定とチャネル/スケジュールの割り当てがAEM パブリッシュインスタンスにレプリケートされます。 その後、AEM Screens デバイス設定が更新され、AEM パブリッシュファームの前にあるロードバランサーを指すようになります。 この構成は、1 回限りの設定を意図しています。 Screens デバイスがパブリッシュ環境に正常に接続されると、オーサー環境からのコマンドを引き続き受信できます。 AEM Screens デバイスをAEM オーサー環境に直接接続する必要はありません。

![screen_shot_2019-02-25at15218pm](assets/screen_shot_2019-02-25at15218pm.png)

### 次の手順 {#the-next-steps}

AEM Screensにおけるオーサーとパブリッシュのセットアップについて詳しくは、を参照してください。 [AEM Screens用のオーサーとパブリッシュの設定](author-and-publish.md) を参照してください。
